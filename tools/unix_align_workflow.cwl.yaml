#!/usr/bin/env cwl-runner

cwlVersion: "cwl:draft-3"

class: Workflow
requirements:
  - class: ScatterFeatureRequirement
  - class: StepInputExpressionRequirement
inputs:
  - id: bam_path
    type: File
outputs:
  - id: align_output_bam
    type:
      type: array
      items: File
    source: "#align/output_bam"
steps:
  - id: bamtoreadgroup
    run: unix_bamreadgroup_cmd.cwl.yaml
    inputs:
      - id: bam_path
        source: "#bam_path"
    outputs:
      - id: output_readgroup
  - id: bamtofastq
    run: unix_bamtofastq_cmd.cwl.yaml
    inputs:
      - id: bam_path
        source: "#bam_path"
    outputs:
      - id: output_fastq1
      - id: output_fastq2
  - id: "#align"
    run: unix_align_cmd.cwl.yaml
    scatter: ["#align/fastq1_path", "#align/fastq2_path", "#align/readgroup_path"]
    scatterMethod: "dotproduct"
    inputs:
      - id: fastq1_path
        source: "#bamtofastq/output_fastq1"
      - id: fastq2_path
        source: "#bamtofastq/output_fastq2"
      - id: readgroup_path
        source: "#bamtoreadgroup/output_readgroup"
    outputs:
      - id: output_bam
