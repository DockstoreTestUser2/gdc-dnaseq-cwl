#!/usr/bin/env cwl-runner

class: Workflow

inputs:
  - id: "#fastq1_path" # temp for testing
    type: File
  - id: "#fastq2_path" # temp for testing
    type: File
  - id: "#readgroup_json_path" # temp for testing
    type: File
  - id: "#input_bam" # temp for testing
    type:
      type: array
      items: File
  - id: "#bam_path"
    type: File
  - id: "#reference_fasta_path"
    type: File
  - id: "#thread_count"
    type: string
  - id: "#uuid"
    type: string
  - id: "#db_cred_s3url"
    type: ["null", string]
  - id: "#s3cfg_path"
    type: ["null", File]
    
outputs:
  - id: "#output_bam"
    type:
      type: array
      items: File
    source: "#bwa_pe.output_bam"


requirements:
  - class: ScatterFeatureRequirement


steps:
    - id: "#bwa_pe"
      run: {import: ../../tools/bwa_pe.cwl.yaml}
      inputs:
        - id: "#bwa_pe.fastq1_path"
          source: "#fastq1_path"
        - id: "#bwa_pe.fastq2_path"
          source: "#fastq2_path"
        - id: "#bwa_pe.reference_fasta_path"
          source: "#reference_fasta_path"
        - id: "#bwa_pe.readgroup_json_path"
          source: "#readgroup_json_path"
        - id: "#bwa_pe.thread_count"
          source: "#thread_count"
        - id: "#bwa_pe.uuid"
          source: "#uuid"
      outputs:
        - id: "#bwa_pe.output_bam"
        - id: "#bwa_pe.log"
