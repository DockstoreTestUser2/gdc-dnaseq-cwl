#!/usr/bin/env cwl-runner

cwlVersion: "cwl:draft-3"

class: Workflow

requirements:
  - class: InlineJavascriptRequirement
  - class: StepInputExpressionRequirement
  - class: SubworkflowFeatureRequirement

inputs:
  - id: bam_s3url
    type: string
  - id: db_snp_s3url
    type: string
  - id: reference_fasta_s3url
    type: string
  - id: db_cred_s3url
    type: string
  - id: thread_count
    type: int
  - id: uuid
    type: string
  - id: aws_config_file
    type: File
  - id: aws_shared_credentials_file
    type: File
  - id: extract_s3cfg_section
    type: string
  - id: extract_endpoint_url
    type: string
  - id: load_s3cfg_section
    type: string
  - id: load_endpoint_url
    type: string
  - id: load_bucket
    type: string

output:
  - id: cwl_json_output
    source: "#etl/dnaseq_workflow_output_sqlite"

steps:
  - id: status_running
    run: ../../tools/queue_status.cwl.yaml
    inputs:
      
  - id: etl
    run: etl.cwl.yaml
    inputs:
      - id: bam_s3url
        source: "#bam_s3url"
      - id: db_snp_s3url
        source: "#db_snp_s3url"
      - id: reference_fasta_s3url
        source: "#reference_fasta_s3url"
      - id: db_cred_s3url
        source: "#db_cred_s3url"
      - id: thread_count
        source: "#thread_count"
      - id: uuid
        source: "#uuid"
      - id: aws_config_file
        source: "#aws_config_file"
      - id: aws_shared_credentials_file
        source: "#aws_shared_credentials_file"
      - id: extract_s3cfg_section
        source: "#extract_s3cfg_section"
      - id: extract_endpoint_url
        source: "#extract_endpoint_url"
      - id: load_s3cfg_section
        source: "#load_s3cfg_section"
      - id: load_endpoint_url
        source: "#load_endpoint_url"
      - id: load_bucket
        source: "#load_bucket"
    outputs:
      - id: output
      - id: bin_time

